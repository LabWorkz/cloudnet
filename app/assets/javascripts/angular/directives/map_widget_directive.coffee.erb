@app.directive "mapWidget", ['ServerSearchState', '$filter', '$templateCache', (State, $filter, $templateCache) ->
  scope: true
  require: 'ngModel'
  link: ($scope, $element, $attr, ngModelCtrl) ->
    popup = _.template($templateCache.get "mapPopup.html")
    keys = 
      mapboxKey: mapboxKey
      mapboxPublicToken: mapboxPublicToken
      fiveHundredPxKey: fiveHundredPxKey
      
    new helpers.MapSearchWidget($scope, $element, ngModelCtrl, State, $filter, keys, popup)
  
]